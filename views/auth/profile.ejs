<%- include('../partials/header') %>

<div class="container">
    <div class="page-header">
        <h1>My Profile</h1>
        <p>Manage your account and fitness information</p>
    </div>
    
    <% if (errors && errors.length > 0) { %>
        <div class="alert alert-error">
            <ul class="error-list">
                <% errors.forEach(function(error) { %>
                    <li><%= error %></li>
                <% }); %>
            </ul>
        </div>
    <% } %>
    
    <div class="profile-grid">
        <div class="profile-sidebar">
            <div class="profile-card">
                <div class="profile-avatar">
                    <%= user.username.charAt(0).toUpperCase() %>
                </div>
                <h2><%= user.username %></h2>
                <p class="profile-email"><%= user.email %></p>
                
                <% if (stats) { %>
                    <div class="profile-stats">
                        <div class="profile-stat">
                            <span class="stat-value"><%= stats.total_workouts || 0 %></span>
                            <span class="stat-label">Workouts</span>
                        </div>
                        <div class="profile-stat">
                            <span class="stat-value"><%= stats.completed_goals || 0 %></span>
                            <span class="stat-label">Goals Met</span>
                        </div>
                        <div class="profile-stat">
                            <span class="stat-value"><%= stats.total_calories || 0 %></span>
                            <span class="stat-label">Calories</span>
                        </div>
                    </div>
                <% } %>
            </div>
        </div>
        
        <div class="profile-main">
            <div class="card">
                <h3>Personal Information</h3>
                <form action="<%= basePath %>/auth/profile" method="POST" class="profile-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="firstName">First Name</label>
                            <input type="text" id="firstName" name="firstName" class="form-input" value="<%= profile.first_name || '' %>">
                        </div>
                        
                        <div class="form-group">
                            <label for="lastName">Last Name</label>
                            <input type="text" id="lastName" name="lastName" class="form-input" value="<%= profile.last_name || '' %>">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="dateOfBirth">Date of Birth</label>
                            <input type="date" id="dateOfBirth" name="dateOfBirth" class="form-input" value="<%= profile.date_of_birth ? new Date(profile.date_of_birth).toISOString().split('T')[0] : '' %>">
                        </div>
                        
                        <div class="form-group">
                            <label for="gender">Gender</label>
                            <select id="gender" name="gender" class="form-select">
                                <option value="">Select...</option>
                                <option value="male" <%= profile.gender === 'male' ? 'selected' : '' %>>Male</option>
                                <option value="female" <%= profile.gender === 'female' ? 'selected' : '' %>>Female</option>
                                <option value="other" <%= profile.gender === 'other' ? 'selected' : '' %>>Other</option>
                                <option value="prefer_not_to_say" <%= profile.gender === 'prefer_not_to_say' ? 'selected' : '' %>>Prefer not to say</option>
                            </select>
                        </div>
                    </div>
                    
                    <h4>Fitness Information</h4>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="heightCm">Height (cm)</label>
                            <input type="number" id="heightCm" name="heightCm" class="form-input" step="0.1" min="50" max="300" value="<%= profile.height_cm || '' %>">
                        </div>
                        
                        <div class="form-group">
                            <label for="weightKg">Weight (kg)</label>
                            <input type="number" id="weightKg" name="weightKg" class="form-input" step="0.1" min="20" max="500" value="<%= profile.weight_kg || '' %>">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="activityLevel">Activity Level</label>
                        <select id="activityLevel" name="activityLevel" class="form-select">
                            <option value="sedentary" <%= profile.activity_level === 'sedentary' ? 'selected' : '' %>>Sedentary (little or no exercise)</option>
                            <option value="light" <%= profile.activity_level === 'light' ? 'selected' : '' %>>Light (exercise 1-3 days/week)</option>
                            <option value="moderate" <%= profile.activity_level === 'moderate' ? 'selected' : '' %>>Moderate (exercise 3-5 days/week)</option>
                            <option value="active" <%= profile.activity_level === 'active' ? 'selected' : '' %>>Active (exercise 6-7 days/week)</option>
                            <option value="very_active" <%= profile.activity_level === 'very_active' ? 'selected' : '' %>>Very Active (hard exercise daily)</option>
                        </select>
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">Save Changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<%- include('../partials/footer') %>
